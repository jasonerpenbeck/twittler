<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" href="twittler.css">
  </head>
  <body>



    <script>

      var settings = {};

      // Initialize an array of month names: need this for basic date formatting
      settings.monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];

      // Initialize username for single-user mode
      settings.username = 'all';

      // Limit number of tweets to be processed on page
      settings.tweetLimit = 250;


      function relDate(date) {
        var timeElapsed = Date.now() - date;
        var pluralText;
        var timeCalc;

        if(timeElapsed <=1000) {
          return "Just now";
        }

        else if(timeElapsed<60000) {
          timeCalc = Math.floor(timeElapsed/1000);
          pluralText = (timeCalc === 1) ? "second" : "seconds";
        }

        else if(timeElapsed<3600000) {
          timeCalc = Math.floor(timeElapsed/60000);
          pluralText = (timeCalc === 1) ?  "minute" : "minutes";
        }

        else if(timeElapsed<86400000) {
          timeCalc = Math.floor(timeElapsed/3600000);
          pluralText = (timeCalc === 1) ? "hour" : "hours";
        }

        else {
          timeCalc = Math.floor(timeElapsed/86400000);
          pluralText = (timeCalc === 1) ? "day" : "days";
        }

        return timeCalc + " " + pluralText + " ago";
      }

      // function that formats date in the basic Month Day, Year configuration
      function basicDate (date) {
        return settings.monthNames[date.getMonth()] + " " + date.getDate() + ", " + date.getFullYear();
      }

      // function that makes link building easier
      function link(url,text) {
        return ['<a href=',url,'>',text,'</a>'].join('');
      }

      function div(contains,divClass,divID) {

        var classInDiv = divClass ? "class = " + divClass: '';
        var idInDiv = divID ? "id = " + divID: '';
        return '<div ' + classInDiv + ' ' +  idInDiv + '>' + contains + '</div>';
      }

      // function that builds div structure of each tweet
      function formatTweet(user,message,date) {

       return [
       '<div class="tweetContainer" id="',
          user,
          '">',
          div(div(link('#','@' + user),"tweetUser",user) + div(date,"tweetTime"),"tweetTopLine"),
          div(message,"tweetBottomLine"),
        '</div>'].join('');
      }


     function displayTweets() {

        var $body = $('body');
        $body.html('');

        // limit the total number of displayed tweets to 25
        var index = (settings.username === 'all') ? streams.home.length - 1 : streams.users[settings.username].length-1 ;
        console.log(index);

        while(index >= 0){

          var tweet = (settings.username === 'all') ? streams.home[index] : streams.users[settings.username][index] ;
          var $tweet = $(formatTweet(tweet.user,tweet.message,relDate(tweet.created_at)));
          $tweet.appendTo($body);
          index -= 1;
        }

        // format every other tweet as border-less
        $('.tweetContainer:even').css({'border':'0px white solid','background': 'white'});

     }

      // show tweets once the document is ready and every two seconds after


      $(document).ready(function() {
        console.log("Ready");

        // Set username
        // this is not resetting the username

        $('.tweetContainer').click(function(){
         settings.username = $(this).attr('id');

         console.log(settings.username);
        });

       });

      setInterval(displayTweets,3000);


    </script>
  </body>
</html>
